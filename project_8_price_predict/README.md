# Проект. Классификация

## Оглавление  
[1. Описание проекта](https://github.com/al-math/sf_data_science/tree/main/project_8_price_predict/README.md#Описание-проекта)  
[2. Какой кейс решаем?](https://github.com/al-math/sf_data_science/tree/main/project_8_price_predict/README.md#Какой-кейс-решаем)  
[3. Краткая информация о данных](https://github.com/al-math/sf_data_science/tree/main/project_8_price_predict/README.md#Краткая-информация-о-данных-(интерпретация-исполнителя))  
[4. Этапы работы над проектом](https://github.com/al-math/sf_data_science/tree/main/project_8_price_predict/README.md#Этапы-работы-над-проектом)  
[5. Результаты](https://github.com/al-math/sf_data_science/tree/main/project_8_price_predict/README.md#Результаты)    
[6. Выводы](https://github.com/al-math/sf_data_science/tree/main/project_8_price_predict/README.md#Выводы) 

### Описание проекта    
Разработать сервис для предсказания стоимости домов на основе истории предложений.

Требования к версиям модулей [здесь](https://github.com/al-math/sf_data_science/tree/main/project_8_price_predict/requirements.txt)

ВАЖНОЕ ПРИМЕЧАНИЕ: ввиду ограничений GitHub на размер файлов, часть файлов нужно разархивировать (project_8_model_search.rar, model.rar), а файлы данных скачать по ссылкам из файлов "uselink.txt".

:arrow_up:[к оглавлению](https://github.com/al-math/sf_data_science/tree/main/project_8_price_predict/README.md#Оглавление)


### Какой кейс решаем?    
Построение регрессионной модели прогноза цены, выгрузка модели и сопуствующих данных для деплоя, оформление модели в виде сервиса, упаковка сервиса в docker-образ.

### Краткая информация о данных (интерпретация исполнителя)
1. status - статус объекта (уникальных значений 160)
2. private pool - наличие индивидуального бассейна (уникальных значений 2: nan, 'Yes')
3. propertyType - описание типа объекта в свободной форме (уникальных значений 1281)
4. street - номер дома и улица, на котрой расположен объект (уникальных значений 337077)
5. baths - пока сложно интерпретировать: или площадь ванной комнаты, либо количество ванных комнат (уникальных значений 230). Возможно, и то, и другое и такие колонки придётся разносить.
6. homeFacts - структурированная в словарь информация об объекте (уникальных значений 321009)<br/>
Массив словарей atAGlanceFacts со структурой "factLabel - factValue".<br/>
Year built (год постройки).<br/>
Remodeled year (год кап. ремонта).<br/>
Heating (обогрев).<br/>
Cooling (охлаждение).<br/>
Parking (количество парковочных мест).<br/>
lotsize ("размер партии/лота").<br/>
Price/sqft (цена за квадратный фут) - здесь может быть утечка данных.<br/>
7. fireplace - характеристики камина (уникальных значений 1654)
8. city - город, где расположен объект (уникальных значений 2027)
9. schools - структурированная информация о близлежащих школах (уникальных значений 297365)<br/>
Словарь из параметров ближайших школ (в основном по 3):<br/>
rating (рейринг): числа, дроби, буквы.<br/>
Distance (расстояние) в милях.<br/>
Grades (возрастной класс) текст с цифрами, сложно будет преобразовывать в чёткий признак.<br/>
name (названия школ).<br/>
10. sqft - площадь объекта в квадратных футах (уникальных значений 25406)
11. zipcode - почтовый код (уникальных значений 4549)
12. beds - информация о спальнях: в одну колонку может быть записано, как количество спален, так и площадь (уникальных значений 1185). Площадь, как в квадратных футах, так и в акрах.
13. state - штат (уникальных значений 39), всегда заполнено.
14. stories - сложно сказать - некий класс объекта (уникальных значений 349). В некоторых колонках записаны просто числа. Предположительно количество владельцев.
15. mls-id - некий идентификатор (уникальных значений 24908). Количество уникальных значений близко к количеству непустых строк. Кандидат на удаление или замену на 0/1.
16. PrivatePool - возможно, дублёр колонки "private pool" (уникальных значений 3: nan, 'yes', 'Yes')
17. MlsId - возможно, дублёр колонки "mls-id" (уникальных значений 232945). Доля уникальных значений также велика.
18. target - целевой признак - стоимость. Количество непустых значений меньше числа строк. Строки с пустой стоимостью бесполезны, их можно будет удалить.
  
:arrow_up:[к оглавлению](https://github.com/al-math/sf_data_science/tree/main/project_8_price_predict/README.md#Оглавление)

### Этапы работы над проектом  
1. Анализ и обработка данных<br/>
1.1. Обработка и очистка данных: подготовка датаесета, проведение EDA<br/>
1.2. Статистический анализ данных, использование инструментов ваизуализации
2. Применение ML и DL<br/>
2.1. Проверка способов решения задачи: от простых к сложным<br/>
2.2. Рассмотрение ансамблиенвых моделей<br/>
2.3. Улучшение выбранной модели путём подбора гиперпараметров
3.	Заключительная часть<br/>
3.1. Проверка решения, рассмотрение бизнес-применимого набора параметров<br/>
3.2. Подготовка выбранного решения к продакшену

:arrow_up:[к оглавлению](https://github.com/al-math/sf_data_science/tree/main/project_8_price_predict/README.md#Оглавление)

### Результаты:  
[Очистка данных, подбор, сохранение модели (архив!)](https://github.com/al-math/sf_data_science/tree/main/project_8_price_predict/project_8_model_search.rar)<br/>
[Проверка сохранённой модели](https://github.com/al-math/sf_data_science/tree/main/project_8_price_predict/manual_model_test.ipynb)<br/>
[Сервис (порт 5000)](https://github.com/al-math/sf_data_science/tree/main/project_8_price_predict/Service/docker)<br/>
Docker-образ доступен по команде "docker pull al85/priceprdct"<br/>
[Проверка сервиса](https://github.com/al-math/sf_data_science/tree/main/project_8_price_predict/Service/test)<br/>

:arrow_up:[к оглавлению](https://github.com/al-math/sf_data_science/tree/main/project_8_price_predict/README.md#Оглавление)


### Выводы:  
В процессе работы над проектом удалось построить и подготовить к продакшену модель, которая даже на сокращённом наборе признаков даёт коэффициент детерминации существенно больше 0.5 (0.81), а средняя процентная ошибка на проверочном наборе данных не превышает 21.3%.<br/>

В первую очередь был произведён разведывательный анализ, обработка и очистка данных.<br/>
Среди интересных моментов можно отметить выявление утечки данных путём анализа матрицы корреляции целевого признака и сконструированного признака.<br/>

Визуализация статистической диаграммы "ящик с усами", а также работа с распределениями признаков позволили очистить данные от выбросов.<br/>

Расшифровка признаков-словарей, а также получение координат объектов позволили сконструировать новые весомые признаки.<br/>
Имел место интересный момент с координатами: была использована карта для визуализации расположения объектов и выяснилось, что некоторые объекты расположены за пределами США, чего быть не должно. Визуализация позволила выявить эту проблему и исключить некорректные данные.<br/>

Применение ансамблиевых моделей и подбор гиперпараметров позволили существенно повысить качество финальной модели по сравнению с простейшими вариантами.<br/>

Полученная модель и вспомогательные данные выгружены в pkl-файлы.<br/>
Модель оформлена в веб-сервис и упакована в docker-образ, что делает её независимой от версии ОС и библиотек.<br/>
Образ доступен по команде "docker pull al85/priceprdct". Для корректной работы сервиса необходимо пробросить порты через параметр "-p 5000:5000".<br/>
Итоговая модель в формате сервиса способна работать, как с одиночными объектами для оценки, так и с пакетами объектов.<br/>
Достаточно развернуть веб-сервис из docker-образа, нацелить на него веб-форму, запрашивающую у пользователя параметры объекта с передачей этих параметров в json-формате и можно применять модель в бизнесе.<br/>
Также можно обратить внимание заказчика на то, что запрашиваемые параметры с точки зрения модели являются наиболее весомыми в определении цены объекта.<br/>

В процессе работы над проектом были использованы дополнительные библиотеки: ast - позволила расшифровать признак-словарь, geopy - позволила преобразовать адрес (почтовый индекс) объекта в числовое представление, с которым может работать модель. Новые признаки, полученные с помощью данных библиотек, вошли в топ 10 важнейших признаков финальной модели. Также использована библиотека prettytable для удобного представления данных при тестировании модели в продакшен-формате.

:arrow_up:[к оглавлению](https://github.com/al-math/sf_data_science/tree/main/project_8_price_predict/README.md#Оглавление)
